# Java对象创建的过程

## 对象创建的方式

- 使用new关键字创建对象

- 使用Class类的newInstance方法创建对象（反射机制）

    这个newInstance方法调用无参的构造器创建对象
        
        Student student = Class.forName("Student类全限定名").newInstrace();
        或
        Student stu = Student.class.newInstrance();

- 使用Construtor的newInstance方法创建对象（反射机制）

    java.lang.relect.Constructor类里也有一个newInstance方法可以创建对象，该方法和Class类中的newInstance方法很像，但是相比之下，
    Constructor类的newInstance方法更加强大些，我们可以通过这个newInstance方法调用有参数的和私有的构造函数.
    
    使用newInstance方法的这两种方式创建对象使用的就是Java的反射机制，事实上Class的newInstance方法内部调用的也是Constructor的newInstance方法

- 使用clone方法创建对象

    无论何时我们调用一个对象的clone方法，JVM都会帮我们创建一个新的，一样的对象，特别需要说明的是，用clone方法创建对象的过程中并不会调用任何构造函数。

- 使用发序列化机制创建对象
    当我们反序列化一个对象时，JVM会给我们创建一个单独的对象，在此过程中不会调用任何构造函数。为了反序列化一个对象，需要实现Serializable接口
    
## 对象创建的过程

虚拟机遇到一条new指令时

1、首先将去检查这个指令的参数是否能在常量池中定位到一个类的符号引用，并且检查这个符号引用代表的类是否已被加载、解析和初始化过。
如果没有，那必须先执行相应的类的加载过程。

符号引用：符号引用以一组符号来描述所引用的目标，符号可以是任何形式的字面量，只要使用时能够无歧义的定位到目标即可。

2、在类加载检查通过后，虚拟机将会为新生对象分配内存。对象所需内存大小在类加载完之后可完全确定。为对象分配空间的任务等同于将一块确定大小的内存空间从Java堆中
划分出来。分配内存有两种方式：一、指针碰撞法；二：空闲列表（Free List）

3、内存分配完之后，虚拟机需要将分配到内存空间都初始化为零值（不包含对象头）

4、接下来，虚拟机将对对象进行必要的设置，例如这个对象的是哪个类的实例、如何才能找到类的元数据信息、对象的哈希码、对象的GC分代年龄等信息。

5、在上面的工作都完成之后，从虚拟机的角度来看，一个新生的对象已经产生，但从Java程序的角度来看，对象创建才刚刚开始——<init>方法还没执行，所有的字段都还为零。
所以一般来说，执行new指令之后会接着执行<init>方法，把对象按照程序员的一员进行初始化，这样一个真正可用的对象才生产完成。

### 对象的内存布局

在HotSpot虚拟机中，对象在内存中的布局可以分为三部分：对象头（Header）、实例数据（Instance Data）和对齐填充（Pading）。

- HotSpot虚拟机的对象头包含两部分信息，第一部分用于存储对象自身的运行时数据，如哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有锁、偏向线程ID、偏向时间戳等，
